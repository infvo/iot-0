
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="nl">
  <head>
    <meta charset="utf-8" />
    <title>Protocollen &#8212; iot-0  documentatie</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/accessibility.css?v=808B982A" />
    <link rel="stylesheet" type="text/css" href="../_static/dragndrop.css?v=1FF7F927" />
    <link rel="stylesheet" type="text/css" href="../_static/poll.css?v=E220AC33" />
    <link rel="stylesheet" type="text/css" href="../_static/parsons.css?v=2F3E13EE" />
    <link rel="stylesheet" type="text/css" href="../_static/js_lib/prettify.css?v=2A364B6B" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/runestonebase.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/mchoice.js?v=6F3B51A7"></script>
    <script type="text/javascript" src="../_static/timedmc.js?v=B010A457"></script>
    <script type="text/javascript" src="../_static/timed.js?v=6789FE30"></script>
    <script type="text/javascript" src="../_static/shortanswer.js?v=BB0B99B1"></script>
    <script type="text/javascript" src="../_static/timed_shortanswer.js?v=B3A117D7"></script>
    <script type="text/javascript" src="../_static/dragndrop.js?v=3984FD8D"></script>
    <script type="text/javascript" src="../_static/timeddnd.js?v=378F237E"></script>
    <script type="text/javascript" src="../_static/poll.js?v=11AD6126"></script>
    <script type="text/javascript" src="../_static/js_lib/prettify.js?v=CA7E8928"></script>
    <script type="text/javascript" src="../_static/js_lib/hammer.min.js?v=73056367"></script>
    <script type="text/javascript" src="../_static/parsons.js?v=93EFFF39"></script>
    <script type="text/javascript" src="../_static/timedparsons.js?v=2EEA9E5A"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/jquery-ui-1.10.3.custom.min.js"></script>
    <script type="text/javascript" src="../_static/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/waypoints.min.js"></script>
    <script type="text/javascript" src="../_static/rangy-core.js"></script>
    <script type="text/javascript" src="../_static/rangy-textrange.js"></script>
    <script type="text/javascript" src="../_static/rangy-cssclassapplier.js"></script>
    <script type="text/javascript" src="../_static/user-highlights.js"></script>
    <script type="text/javascript" src="../_static/jquery.idle-timer.js"></script>
    <script type="text/javascript" src="../_static/processing-1.4.1.min.js"></script>
    <script type="text/javascript" src="../_static/jquery.hotkey.js"></script>
    <script type="text/javascript" src="../_static/jquery-migrate-1.2.1.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Zoeken" href="../search.html" />
    <link rel="next" title="Opdrachten" href="opdrachten.html" />
    <link rel="prev" title="IoT-ketens" href="iot-ketens.html" />

<script type="text/javascript">
  eBookConfig = {};
  eBookConfig.host = '' ? '' : 'http://127.0.0.1:8000';
/*
  eBookConfig.app = eBookConfig.host+'/';
  eBookConfig.ajaxURL = eBookConfig.app+'/ajax/';
  eBookConfig.course = '';
  eBookConfig.logLevel = ;
  eBookConfig.loginRequired = ;
  eBookConfig.build_info = "";
  eBookConfig.isLoggedIn = false;
  eBookConfig.useRunestoneServices = ;
  eBookConfig.python3 = ;
  eBookConfig.basecourse = '';
  eBookConfig.runestone_version = '';
*/
</script>
<script type="application/json" class="js-hypothesis-config">
{
"showHighlights": false
}
</script>
<script async src="https://hypothes.is/embed.js"></script>

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">iot-0</a></h1>








<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../voorwoord.html">Voorwoord</a></li>
<li class="toctree-l1"><a class="reference internal" href="../inleiding.html">Inleiding</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../bouwstenen.html">Bouwstenen</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="iot-bouwstenen.html">IoT-bouwstenen</a></li>
<li class="toctree-l2"><a class="reference internal" href="iot-ketens.html">IoT-ketens</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Protocollen</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#protocolstack">Protocolstack</a></li>
<li class="toctree-l3"><a class="reference internal" href="#interactie">Interactie</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adressering">Adressering</a></li>
<li class="toctree-l3"><a class="reference internal" href="#payload">Payload</a></li>
<li class="toctree-l3"><a class="reference internal" href="#overzicht">Overzicht</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="opdrachten.html">Opdrachten</a></li>
<li class="toctree-l2"><a class="reference internal" href="nodered-opdrachten.html">NodeRed opdrachten</a></li>
<li class="toctree-l2"><a class="reference internal" href="toetsvragen.html">Toetsvragen</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../webserver.html">Webserver-knopen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../wifi.html">WiFi-MQTT-knopen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rfm69.html">RFM69-knopen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lora.html">LoRa-knopen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configureren.html">Configureren</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ten-geleide.html">Voor de docent</a></li>
</ul>
<p class="caption"><span class="caption-text">Andere modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://infvo.github.io/com-0/">Com-0</a></li>
<li class="toctree-l1"><a class="reference external" href="https://infvo.github.io/iot-1/">IoT-1</a></li>
</ul>


  <p class="topless"><a href="iot-ketens.html"
                        title="vorig hoofdstuk">Vorige</a></p>
  <p class="topless"><a href="opdrachten.html"
                        title="volgend hoofdstuk">Volgende</a></p>
<div id="searchbox" style="display: none" role="search">

    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Zoek" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="protocollen">
<h1>Protocollen<a class="headerlink" href="#protocollen" title="Permalink naar deze titel">¶</a></h1>
<div class="section" id="protocolstack">
<h2>Protocolstack<a class="headerlink" href="#protocolstack" title="Permalink naar deze titel">¶</a></h2>
<p>Bij de communicatie tussen de onderdelen van een IoT-keten hebben we te maken met verschillende <em>protocollen</em>.
op meerdere niveau’s.
De <em>protocolstack</em> van het internet er als volgt uit:</p>
<ul class="simple">
<li><p>toepassingenlaag - MQTT, HTTP enz., en de protocollen daarboven</p></li>
<li><p>transportlaag - TCP (en TLS, voor veilige verbindingen), UDP</p></li>
<li><p>netwerklaag - IP (“internet protocol”)</p></li>
<li><p>datalink-laag - (fysieke laag) op basis van Ethernet, WiFi, enz.</p></li>
</ul>
<p>De onderste twee lagen vormen de verbinding <em>in het netwerk</em>.
De lagen daarboven zijn <em>end-to-end</em> protocollen: deze vind je in de <em>end devices</em>, niet in het (IP)netwerk.
Voorbeelden van end-devices: IoT-knoop, controller, server, browser;
ook een MQTT-broker is voor het internet een end-device.
Voorbeelden van network-devices: gateway, router, firewall.</p>
<div class="figure align-center" id="id1">
<a class="reference internal image-reference" href="../_images/HTTP-IP-stack.png"><img alt="../_images/HTTP-IP-stack.png" src="../_images/HTTP-IP-stack.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-text">Protocol-stacks in HTTP client-server verbinding</span><a class="headerlink" href="#id1" title="Permallink naar deze afbeelding">¶</a></p>
</div>
<p>HTTP en MQTT zijn voorbeelden van end-to-end protocollen:
deze vind je alleen in de eindpunten (end devices).
Het IP-protocol geeft de ingepakte HTTP-data ongewijzigd door:
“het heeft geen boodschap aan de boodschap”,
net als bijvoorbeeld de traditionele post of telefonie.</p>
<p>Je kunt bovenop MQTT en HTTP je eigen end-to-end toepassingsprotocollen bedenken.
In de voorbeelden gebruiken we een protocol voor de sensor/actuatordata van de IoT-knopen.
Door hetzelfde protocol te gebruiken voor de verschillende IoT-ketens,
met verschillende radio’s in de “edge”, kunnen we de rest van de keten grotendeels gelijk houden.</p>
<div class="admonition-end-to-end admonition">
<p class="admonition-title">End-to-end</p>
<p>Het <em>end-to-end</em> principe is één van de belangrijke bouwstenen van het internet.
Het IP-protocol is het enige protocol <em>in het netwerk</em>.
Dit is een uniform en universeel communicatieprotocol, gebaseerd op best-effort pakketcommunicatie.
Alle aanpassingen aan de toepassingen gebeuren in de eindpunten (<em>end devices</em>).
Dank zij dit end-to-end principe is het internet universeel en uitbreidbaar:
iedereen kan een eigen end-to-end protocol gebruiken voor de eigen toepassingen.</p>
</div>
</div>
<div class="section" id="interactie">
<h2>Interactie<a class="headerlink" href="#interactie" title="Permalink naar deze titel">¶</a></h2>
<div class="figure align-right" id="id2">
<a class="reference internal image-reference" href="../_images/IoT-client-server-0.png"><img alt="../_images/IoT-client-server-0.png" src="../_images/IoT-client-server-0.png" style="width: 300px;" /></a>
<p class="caption"><span class="caption-text">Client-server interactie (HTTP)</span><a class="headerlink" href="#id2" title="Permallink naar deze afbeelding">¶</a></p>
</div>
<p>Het webprotocol HTTP gebruikt een <em>client-server</em> interactie:
de browser (client) stuurt een verzoek (met een URL) naar de webserver,
en krijgt als response van de webserver het bijbehorende HTML-document.
Overigens kunnen ook andere programma’s als webclient optreden.</p>
<div class="figure align-right" id="id3">
<a class="reference internal image-reference" href="../_images/MQTT.png"><img alt="../_images/MQTT.png" src="../_images/MQTT.png" style="width: 300px;" /></a>
<p class="caption"><span class="caption-text">Publish-subscribe interactie (MQTT)</span><a class="headerlink" href="#id3" title="Permallink naar deze afbeelding">¶</a></p>
</div>
<p>Het IoT-protocol MQTT gebruikt een <em>publish-subscribe</em> interactie,
waarbij een <em>broker</em> als tussenschakel fungeert tussen de clients:</p>
<ul class="simple">
<li><p>een client “pusht” een bericht met een bepaald <em>topic</em> naar de broker,</p></li>
<li><p>de broker “pusht” een ontvangen bericht naar alle clients die op dit topic geabonneerd zijn.</p></li>
</ul>
<p>Zowel de IoT-knopen en de controllers zijn clients van de MQTT-broker:
voor de broker zijn deze gelijkwaardig.</p>
</div>
<div class="section" id="adressering">
<h2>Adressering<a class="headerlink" href="#adressering" title="Permalink naar deze titel">¶</a></h2>
<p>In een netwerk moeten de verschillende apparaten elkaar kunnen vinden:
<em>adressering</em> is een onderdeel van een netwerpprotocol.
Op elk niveau van de protocolstack komen we een passende vorm van adressering tegen:</p>
<ul class="simple">
<li><p>HTTP: URL; MQTT: topic (adres van de IoT-knoop);</p></li>
<li><p>TCP: poortnummer (adres van de toepassing)</p></li>
<li><p>IP: ip-adres en domeinnaam (adres van de “host”: end-device)</p></li>
<li><p>WiFi: MAC-adres; RFM69: node-nr; LoRa: device-EUI (hardware-adres)</p></li>
</ul>
<p>In de IoT-toepassingen gebruiken we het nummer van de IoT-knoop als identificatie en adres.
Dit nummer leiden we af van het MAC-adres, of we wijzen dit zelf toe.</p>
</div>
<div class="section" id="payload">
<h2>Payload<a class="headerlink" href="#payload" title="Permalink naar deze titel">¶</a></h2>
<p>Bij een protocol hoort ook een <em>payload</em>: de eigenlijke data.
Voor een toepassing maken we afspraken over het payload-formaat.
Voor onze IoT-toepassingen gebruiken we het JSON-formaat met daarin het Cayenne-LPP formaat voor de sensordata.</p>
<ul class="simple">
<li><p>HTTP: HTML als payload-formaat; MQTT: (JSON)</p></li>
<li><p>TCP: bytestroom</p></li>
<li><p>IP: payload-deel van pakket, met (o.a.) fragmenten van de TCP bytestroom.</p></li>
<li><p>Ethernet, WiFi: frames (pakketten op fysiek niveau) met IP-pakketten als payload.</p></li>
</ul>
<p>Naast de payload hebben we te maken met de <em>meta-data</em> van het protocol.
Deze bestaat bijvoorbeeld uit het adres van de bestemming, het adres van de afzender,
een identificatie van het hoger-niveau protocol.
In het geval van radio-verbindingen kan bijvoorbeeld de signaalsterkte opgenomen zijn in de meta-data.</p>
</div>
<div class="section" id="overzicht">
<h2>Overzicht<a class="headerlink" href="#overzicht" title="Permalink naar deze titel">¶</a></h2>
<p class="rubric">HTTP (web)</p>
<p>HTTP is het protocol van het web.
In het gedeelte over IoT-knopen als webserver gaan we dieper op dit protocol in.</p>
<p class="rubric">MQTT (IoT)</p>
<p>MQTT is een basisprotocol voor het Internet of Things.
We gebruiken dit protocol voor het verkeer tussen de WiFi IoT-knoop en de controller(s),
tussen de RFM69 gateway en de controller, tussen de LoRa server en de controller,
en tussen de controllers onderling.
In het deel over WiFi-MQTT knopen behandelen we dit protocol.</p>
<p class="rubric">RFM69</p>
<p>RFM69 is één van de vele pakketradio’s voor het IoT,
met een eigen protocol.
In de kleine pakketten (max. 60 bytes) past alleen een binaire payload.
Hiervoor gebruiken we het Cayenne Low Power Payload-formaat (C-LPP).
In het deel over RFM69 werken we dit verder uit;
we gaan daar ook in op de protocolconversie in de gateway tussen het RFM69 netwerk met de IoT-knopen,
en het IP-netwerk.</p>
<p class="rubric">LoRa(Wan)</p>
<p>De LoRa radio’s in het LoRaWan gebruiken ook een eigen pakketformaat.
Dit wordt in de TTN gateways/servers omgezet in een MQTT-formaat.
Ook in dit geval gebruiken we een binaire payload:
de pakketten zijn meest 10-20 bytes groot (of liever: klein).</p>
</div>
</div>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
<jinja2.runtime.BlockReference object at 0x108b6be50>
<script type="text/javascript">
  $(document).trigger("runestone:login-complete");
</script>

  </body>
</html>