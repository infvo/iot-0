
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="nl">
  <head>
    <meta charset="utf-8" />
    <title>MQTT-opdrachten &#8212; iot-0  documentatie</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/accessibility.css?v=808B982A" />
    <link rel="stylesheet" type="text/css" href="../_static/dragndrop.css?v=1FF7F927" />
    <link rel="stylesheet" type="text/css" href="../_static/poll.css?v=E220AC33" />
    <link rel="stylesheet" type="text/css" href="../_static/parsons.css?v=2F3E13EE" />
    <link rel="stylesheet" type="text/css" href="../_static/js_lib/prettify.css?v=2A364B6B" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/runestonebase.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/mchoice.js?v=6F3B51A7"></script>
    <script type="text/javascript" src="../_static/timedmc.js?v=B010A457"></script>
    <script type="text/javascript" src="../_static/timed.js?v=6789FE30"></script>
    <script type="text/javascript" src="../_static/shortanswer.js?v=BB0B99B1"></script>
    <script type="text/javascript" src="../_static/timed_shortanswer.js?v=B3A117D7"></script>
    <script type="text/javascript" src="../_static/dragndrop.js?v=3984FD8D"></script>
    <script type="text/javascript" src="../_static/timeddnd.js?v=378F237E"></script>
    <script type="text/javascript" src="../_static/poll.js?v=11AD6126"></script>
    <script type="text/javascript" src="../_static/js_lib/prettify.js?v=CA7E8928"></script>
    <script type="text/javascript" src="../_static/js_lib/hammer.min.js?v=73056367"></script>
    <script type="text/javascript" src="../_static/parsons.js?v=93EFFF39"></script>
    <script type="text/javascript" src="../_static/timedparsons.js?v=2EEA9E5A"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/jquery-ui-1.10.3.custom.min.js"></script>
    <script type="text/javascript" src="../_static/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/waypoints.min.js"></script>
    <script type="text/javascript" src="../_static/rangy-core.js"></script>
    <script type="text/javascript" src="../_static/rangy-textrange.js"></script>
    <script type="text/javascript" src="../_static/rangy-cssclassapplier.js"></script>
    <script type="text/javascript" src="../_static/user-highlights.js"></script>
    <script type="text/javascript" src="../_static/jquery.idle-timer.js"></script>
    <script type="text/javascript" src="../_static/processing-1.4.1.min.js"></script>
    <script type="text/javascript" src="../_static/jquery.hotkey.js"></script>
    <script type="text/javascript" src="../_static/jquery-migrate-1.2.1.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Zoeken" href="../search.html" />
    <link rel="next" title="NodeRed-opdrachten" href="nodered-opdrachten.html" />
    <link rel="prev" title="JSON" href="json-lpp.html" />

<script type="text/javascript">
  eBookConfig = {};
  eBookConfig.host = '' ? '' : 'http://127.0.0.1:8000';
/*
  eBookConfig.app = eBookConfig.host+'/';
  eBookConfig.ajaxURL = eBookConfig.app+'/ajax/';
  eBookConfig.course = '';
  eBookConfig.logLevel = ;
  eBookConfig.loginRequired = ;
  eBookConfig.build_info = "";
  eBookConfig.isLoggedIn = false;
  eBookConfig.useRunestoneServices = ;
  eBookConfig.python3 = ;
  eBookConfig.basecourse = '';
  eBookConfig.runestone_version = '';
*/
</script>
<script type="application/json" class="js-hypothesis-config">
{
"showHighlights": false
}
</script>
<script async src="https://hypothes.is/embed.js"></script>

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">iot-0</a></h1>








<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../voorwoord.html">Voorwoord</a></li>
<li class="toctree-l1"><a class="reference internal" href="../inleiding.html">Inleiding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bouwstenen.html">Bouwstenen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../webserver.html">Webserver-knopen</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../wifi.html">WiFi-MQTT-knopen</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="wifi-keten.html">MQTT-ketens</a></li>
<li class="toctree-l2"><a class="reference internal" href="mqtt-interactie.html">Publish-subscribe</a></li>
<li class="toctree-l2"><a class="reference internal" href="wifi-protocol.html">Protocol: MQTT</a></li>
<li class="toctree-l2"><a class="reference internal" href="json-lpp.html">JSON</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">MQTT-opdrachten</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mqtt-chat">(1) MQTT-chat</a></li>
<li class="toctree-l3"><a class="reference internal" href="#knoop-volgen">(2): Knoop volgen</a></li>
<li class="toctree-l3"><a class="reference internal" href="#knoop-besturen">(3) Knoop besturen</a></li>
<li class="toctree-l3"><a class="reference internal" href="#json-in-het-iot">(4) JSON in het IoT</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="nodered-opdrachten.html">NodeRed-opdrachten</a></li>
<li class="toctree-l2"><a class="reference internal" href="toetsvragen.html">Toetsvragen</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../rfm69.html">RFM69-knopen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lora.html">LoRa-knopen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configureren.html">Configureren</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ten-geleide.html">Voor de docent</a></li>
</ul>
<p class="caption"><span class="caption-text">Andere modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://infvo.github.io/com-0/">Com-0</a></li>
<li class="toctree-l1"><a class="reference external" href="https://infvo.github.io/iot-1/">IoT-1</a></li>
</ul>


  <p class="topless"><a href="json-lpp.html"
                        title="vorig hoofdstuk">Vorige</a></p>
  <p class="topless"><a href="nodered-opdrachten.html"
                        title="volgend hoofdstuk">Volgende</a></p>
<div id="searchbox" style="display: none" role="search">

    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Zoek" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="mqtt-opdrachten">
<h1>MQTT-opdrachten<a class="headerlink" href="#mqtt-opdrachten" title="Permalink naar deze titel">¶</a></h1>
<div class="topic">
<p class="topic-title first">Wat heb je nodig?</p>
<ul class="simple">
<li><dl class="simple">
<dt>MQTT broker in publieke internet;</dt><dd><ul>
<li><p>bijvoorbeeld: <code class="docutils literal notranslate"><span class="pre">infvopedia.nl:1883</span></code>;</p></li>
<li><p>de MQTT-broker fungeert ook als statische webserver,
voor de app MQT3 en voor de IoT-knoop-simulator;</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>de app MQT3 (<a class="reference external" href="http://infvopedia.nl/mqt3.html">http://infvopedia.nl/mqt3.html</a>, zie ook <a class="reference internal" href="../bouwstenen/opdrachten.html#mqt3"><span class="std std-ref">De app MQT3</span></a>)</p></li>
<li><dl class="simple">
<dt>zo mogelijk: hardware IoT-knoop,</dt><dd><ul>
<li><p>met software: <code class="docutils literal notranslate"><span class="pre">wifi-node-xd</span></code>;</p></li>
<li><p>geconfigureerd voor het lokale WiFi-netwerk en de MQTT-broker,
zie hieronder;</p></li>
<li><p>de ID van de knoop bestaat uit de laatste 4 cijfers van het MAC-adres;
deze ID staat ook op de knoop zelf.</p></li>
<li><p>met een extra led (led1)</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>als alternatief: een gesimuleerde IoT-knoop,
via <a class="reference external" href="http://infvopedia.nl/iotnode-app.html">http://infvopedia.nl/iotnode-app.html</a>.
Geef deze zelf een unieke ID.</p></li>
</ul>
</div>
<div class="section" id="mqtt-chat">
<h2>(1) MQTT-chat<a class="headerlink" href="#mqtt-chat" title="Permalink naar deze titel">¶</a></h2>
<p><strong>(stap 1)</strong> Je kunt met MQTT met elkaar chatten,
via de MQT3-app in je browser.</p>
<ol class="arabic simple">
<li><p>Spreek af welk <em>topic</em> je gebruikt voor de communicatie, bijvoorbeeld <code class="docutils literal notranslate"><span class="pre">chat</span></code></p></li>
<li><p>Stel dit topic in bij de beide topic-vensters: voor het ontvangen (<em>subscribe</em>)
en voor het verzenden (<em>publish</em>) van de berichten.</p></li>
<li><p>Als je nu in de ene browser in de app een bericht invoert en publiceert,
zie je dit in de andere browsers in de app verschijnen.</p></li>
</ol>
<p><strong>(stap 2)</strong> Een nadeel van deze aanpak is dat je niet kunt zien van wie een bericht afkomstig is.
Dit kun je oplossen door de naam van de afzender in het topic op te nemen:</p>
<ol class="arabic simple" start="4">
<li><p>vul als <strong>subscribe-topic</strong> een wildcard-topic in, bijvoorbeeld <code class="docutils literal notranslate"><span class="pre">chat/+</span></code> .
Deze <code class="docutils literal notranslate"><span class="pre">+</span></code> matcht met een willekeurige string.</p></li>
<li><p>vul als <strong>publish-topic</strong> een topic in met daarin de naam van de afzender,
bijvoorbeeld <code class="docutils literal notranslate"><span class="pre">chat/frans</span></code> .</p></li>
<li><p>je ziet dan bij de ontvangen berichten steeds de naam van de afzender in het topic.</p></li>
</ol>
<p>Je moet er in dit geval wel op vertrouwen dat iedereen zijn eigen naam invult:
je kunt de afzender in het topic niet authenticeren.</p>
</div>
<div class="section" id="knoop-volgen">
<h2>(2): Knoop volgen<a class="headerlink" href="#knoop-volgen" title="Permalink naar deze titel">¶</a></h2>
<p>In deze opdracht gebruik je MQT3 om het verkeer van een bestaande IoT-knoop te volgen,
en om de sensordata netjes weer te geven.
Voor de communicatie tussen MQT3 en de IoT-knoop met ID <code class="docutils literal notranslate"><span class="pre">xxxx</span></code> gebruiken we de volgende <em>topics</em>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">node/xxxx/sensors</span></code> - voor de sensorwaarden</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">node/xxxx/actuators</span></code> - voor de actuatorwaarden.</p></li>
</ul>
<p>Met het wildcard-topic <code class="docutils literal notranslate"><span class="pre">node/+/+</span></code> ontvang je alle sensor/actuatorwaarden van alle knopen.
Er is geen standaard die de vorm van deze topics afdwingt: het is een eigen, praktische keuze.
Deze keuze gebruiken we in de IoT-knopen en in de toepassingen (apps).</p>
<p>(<strong>stap 1</strong>) Eerst moeten we de ID van een bestaande knoop zien te vinden.
Dit doen we door voor het subscribe-veld een <em>wildcard</em>-topic in te vullen.</p>
<ol class="arabic simple">
<li><p>vul als subscribe-topic in: <code class="docutils literal notranslate"><span class="pre">node/+/sensors</span></code>;</p></li>
<li><p>je krijgt nu de sensor-berichten te zien van alle knopen die deze broker gebruiken.</p></li>
<li><p>kies hiervan een knoop die je regelmatig langs ziet komen, en bepaal de ID xxxx (uit <code class="docutils literal notranslate"><span class="pre">node/xxxx/sensors</span></code>).</p></li>
</ol>
<p>Als je een hardware-IoT-knoop hebt, dan staat de ID waarschijnlijk op de knoop zelf.
De node-ID bestaat uit de laatste 4 tekens van het MAC-adres.
Controleer of je knoop actief is: er moeten dan regelmatig JSON-berichten langskomen in het subscribe-venster
(bijvoorbeeld elke 1-2 minuten).</p>
<p>(<strong>stap 2</strong>) We willen de sensordata weergeven in het bovenste deel van MQT3.</p>
<ol class="arabic simple" start="4">
<li><p>vul bij <code class="docutils literal notranslate"><span class="pre">IoT-node</span></code> de ID in van je gekozen knoop.</p></li>
<li><p>vul als subscribe-topic in: <code class="docutils literal notranslate"><span class="pre">node/xxxx/+</span></code> (waarin <code class="docutils literal notranslate"><span class="pre">xxxx</span></code> staat voor de gekozen ID).
je ziet dan alle sensor- en actuator-berichten van deze IoT-knoop verschijnen.</p></li>
<li><p>na enige tijd verschijnen de waarden van de sensoren in tabelvorm;
in het subscribe-venster zie je deze in JSON-vorm.</p></li>
<li><p>Verduister de knoop (bijvoorbeeld met een doekje).
Controleer dat het volgende sensor-bericht van de knoop een andere waarde voor de analoge input (LDR) geeft.</p></li>
</ol>
<p>Om over na te denken:</p>
<ul class="simple">
<li><p>hoe weet je wat de eigenschap (het veld) <code class="docutils literal notranslate"><span class="pre">&quot;temperature&quot;</span></code> voorstelt?</p></li>
</ul>
</div>
<div class="section" id="knoop-besturen">
<h2>(3) Knoop besturen<a class="headerlink" href="#knoop-besturen" title="Permalink naar deze titel">¶</a></h2>
<p>Via MQT3 kun je de LED(s) van de knoop <code class="docutils literal notranslate"><span class="pre">xxxx</span></code> aansturen.</p>
<p><strong>(stap 1)</strong> Aansturen van <code class="docutils literal notranslate"><span class="pre">led0</span></code>:</p>
<ol class="arabic simple">
<li><p>vul als <code class="docutils literal notranslate"><span class="pre">subscribe</span> <span class="pre">to</span> <span class="pre">topic</span></code> in: <code class="docutils literal notranslate"><span class="pre">node/xxxx/+</span></code> (waarin <code class="docutils literal notranslate"><span class="pre">xxxx</span></code> staat voor de gekozen ID);</p></li>
<li><p>met de knoppen bovenin kun je <code class="docutils literal notranslate"><span class="pre">led0</span></code> aan- en uitschakelen;</p></li>
<li><p>controleer bij de sensorwaarden of deze led inderdaad uit- en uitgaat.</p></li>
<li><p>ga in het subscribe-venster na welke berichten langskomen als je een knop indrukt,
voor de actuatoren (leds) en voor de sensoren.
(a) Welk bericht stuurt de knop On? met welk topic?
(b) En welk bericht stuurt de knop Off?</p></li>
</ol>
<p>Als de (hardware) IoT-knoop <code class="docutils literal notranslate"><span class="pre">xxxx</span></code> in je buurt is, kun je controleren of de LED aan- en uitgaat.</p>
<p><strong>(stap 2)</strong> Je kunt <code class="docutils literal notranslate"><span class="pre">led1</span></code> “met de hand” aansturen.
Door de juiste JSON-berichten te sturen naar het actuator-topic van je knoop,
kun je ook de andere led besturen.</p>
<ol class="arabic simple" start="5">
<li><p>vul als <code class="docutils literal notranslate"><span class="pre">publish</span> <span class="pre">to</span> <span class="pre">topic</span></code> in: <code class="docutils literal notranslate"><span class="pre">node/xxxx/actuators</span></code> (waarin <code class="docutils literal notranslate"><span class="pre">xxxx</span></code> staat voor de gekozen ID)</p></li>
<li><p>vul in het <code class="docutils literal notranslate"><span class="pre">publish</span></code>-veld in: het bericht dat je gevonden hebt onder (4a) hierboven,
aangepast aan <code class="docutils literal notranslate"><span class="pre">led1</span></code>.</p></li>
<li><p>klik op “Publish”</p></li>
<li><p>controleer de berichten die langskomen in het subscribe-venster,
en de status van <code class="docutils literal notranslate"><span class="pre">led1</span></code> in de sensortabel.</p></li>
<li><p>schakel beide leds uit (of aan) met één enkel JSON-bericht.</p></li>
</ol>
</div>
<div class="section" id="json-in-het-iot">
<h2>(4) JSON in het IoT<a class="headerlink" href="#json-in-het-iot" title="Permalink naar deze titel">¶</a></h2>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Te doen</p>
<p>nog aanvullen</p>
</div>
<p>Het JSON-formaat wordt in het Internet of Things op meerdere plaatsen gebruikt.
Bestudeer de volgende manieren van gebruik:</p>
<ul class="simple">
<li><p>importeren en exporteren van NodeRed-flows</p></li>
<li><dl class="simple">
<dt>berichten van TTN gateways (via MQTT)</dt><dd><ul>
<li><p>welke informatie voegt een TTN gateway toe aan de “payload” van een IoT-knoop?</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
<jinja2.runtime.BlockReference object at 0x108ab7e10>
<script type="text/javascript">
  $(document).trigger("runestone:login-complete");
</script>

  </body>
</html>