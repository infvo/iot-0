
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="nl">
  <head>
    <meta charset="utf-8" />
    <title>JSON &#8212; iot-0  documentatie</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/accessibility.css?v=808B982A" />
    <link rel="stylesheet" type="text/css" href="../_static/dragndrop.css?v=1FF7F927" />
    <link rel="stylesheet" type="text/css" href="../_static/poll.css?v=E220AC33" />
    <link rel="stylesheet" type="text/css" href="../_static/parsons.css?v=2F3E13EE" />
    <link rel="stylesheet" type="text/css" href="../_static/js_lib/prettify.css?v=2A364B6B" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/runestonebase.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/mchoice.js?v=6F3B51A7"></script>
    <script type="text/javascript" src="../_static/timedmc.js?v=B010A457"></script>
    <script type="text/javascript" src="../_static/timed.js?v=6789FE30"></script>
    <script type="text/javascript" src="../_static/shortanswer.js?v=BB0B99B1"></script>
    <script type="text/javascript" src="../_static/timed_shortanswer.js?v=B3A117D7"></script>
    <script type="text/javascript" src="../_static/dragndrop.js?v=3984FD8D"></script>
    <script type="text/javascript" src="../_static/timeddnd.js?v=378F237E"></script>
    <script type="text/javascript" src="../_static/poll.js?v=11AD6126"></script>
    <script type="text/javascript" src="../_static/js_lib/prettify.js?v=CA7E8928"></script>
    <script type="text/javascript" src="../_static/js_lib/hammer.min.js?v=73056367"></script>
    <script type="text/javascript" src="../_static/parsons.js?v=93EFFF39"></script>
    <script type="text/javascript" src="../_static/timedparsons.js?v=2EEA9E5A"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/jquery-ui-1.10.3.custom.min.js"></script>
    <script type="text/javascript" src="../_static/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/waypoints.min.js"></script>
    <script type="text/javascript" src="../_static/rangy-core.js"></script>
    <script type="text/javascript" src="../_static/rangy-textrange.js"></script>
    <script type="text/javascript" src="../_static/rangy-cssclassapplier.js"></script>
    <script type="text/javascript" src="../_static/user-highlights.js"></script>
    <script type="text/javascript" src="../_static/jquery.idle-timer.js"></script>
    <script type="text/javascript" src="../_static/processing-1.4.1.min.js"></script>
    <script type="text/javascript" src="../_static/jquery.hotkey.js"></script>
    <script type="text/javascript" src="../_static/jquery-migrate-1.2.1.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Zoeken" href="../search.html" />
    <link rel="next" title="MQTT-opdrachten" href="opdrachten.html" />
    <link rel="prev" title="Protocol: MQTT" href="wifi-protocol.html" />

<script type="text/javascript">
  eBookConfig = {};
  eBookConfig.host = '' ? '' : 'http://127.0.0.1:8000';
/*
  eBookConfig.app = eBookConfig.host+'/';
  eBookConfig.ajaxURL = eBookConfig.app+'/ajax/';
  eBookConfig.course = '';
  eBookConfig.logLevel = ;
  eBookConfig.loginRequired = ;
  eBookConfig.build_info = "";
  eBookConfig.isLoggedIn = false;
  eBookConfig.useRunestoneServices = ;
  eBookConfig.python3 = ;
  eBookConfig.basecourse = '';
  eBookConfig.runestone_version = '';
*/
</script>
<script type="application/json" class="js-hypothesis-config">
{
"showHighlights": false
}
</script>
<script async src="https://hypothes.is/embed.js"></script>

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">iot-0</a></h1>








<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../voorwoord.html">Voorwoord</a></li>
<li class="toctree-l1"><a class="reference internal" href="../inleiding.html">Inleiding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bouwstenen.html">Bouwstenen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../webserver.html">Webserver-knopen</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../wifi.html">WiFi-MQTT-knopen</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="wifi-keten.html">MQTT-ketens</a></li>
<li class="toctree-l2"><a class="reference internal" href="mqtt-interactie.html">Publish-subscribe</a></li>
<li class="toctree-l2"><a class="reference internal" href="wifi-protocol.html">Protocol: MQTT</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">JSON</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#json-lpp">JSON-LPP</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="opdrachten.html">MQTT-opdrachten</a></li>
<li class="toctree-l2"><a class="reference internal" href="nodered-opdrachten.html">NodeRed-opdrachten</a></li>
<li class="toctree-l2"><a class="reference internal" href="toetsvragen.html">Toetsvragen</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../rfm69.html">RFM69-knopen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lora.html">LoRa-knopen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configureren.html">Configureren</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ten-geleide.html">Voor de docent</a></li>
</ul>
<p class="caption"><span class="caption-text">Andere modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://infvo.github.io/com-0/">Com-0</a></li>
<li class="toctree-l1"><a class="reference external" href="https://infvo.github.io/iot-1/">IoT-1</a></li>
</ul>


  <p class="topless"><a href="wifi-protocol.html"
                        title="vorig hoofdstuk">Vorige</a></p>
  <p class="topless"><a href="opdrachten.html"
                        title="volgend hoofdstuk">Volgende</a></p>
<div id="searchbox" style="display: none" role="search">

    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Zoek" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="json">
<h1>JSON<a class="headerlink" href="#json" title="Permalink naar deze titel">¶</a></h1>
<p>In dit hoofdstuk gebruiken we MQTT voor het bewaken en besturen van een IoT-knoop.
De communicatie tussen de IoT-knoop en de toepassing (app), via de MQTT-broker,
vindt plaats in de vorm van JSON-berichten.
Het JSON-formaat is voor het IoT wat HTML is voor het web.
We leggen hieronder eerst de principes van JSON uit.
In de opdracht gebruik je JSON voor het aansturen van de IoT-knoop.</p>
<p>JSON staat voor “JavaScript Object Notatie”.
Een JSON-document is een tekstdocument: een leesbare vorm van een JavaScript-object.
Een object bestaat uit een aantal <em>naam: waarde-paren</em>.
Een waarde kan een enkelvoudige waarde zijn, bijvoorbeeld een getal, een string, of een boolean.
Het kan ook een samengestelde waarde zijn: een object of een array.
In JavaScript gebruiken we de notatie: <code class="docutils literal notranslate"><span class="pre">naam:</span> <span class="pre">waarde</span></code>.
In JSON staat de naam tussen dubbele quotes: <code class="docutils literal notranslate"><span class="pre">&quot;naam&quot;:</span> <span class="pre">waarde</span></code>.</p>
<p>We geven in de onderstaande voorbeelden de JavaScript-objecten en de bijbehorende JSON-notatie.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nx">temp</span><span class="o">:</span> <span class="mi">21</span><span class="p">,</span> <span class="nx">press</span><span class="o">:</span> <span class="mi">1015</span><span class="p">,</span> <span class="nx">id</span><span class="o">:</span> <span class="s2">&quot;e4c7&quot;</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;temp&quot;</span><span class="p">:</span><span class="mi">123</span><span class="p">,</span><span class="nt">&quot;press&quot;</span><span class="p">:</span><span class="mi">1012</span><span class="p">,</span> <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;e4c7&quot;</span><span class="p">}</span>
</pre></div>
</div>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Te doen</p>
<ul class="simple">
<li><p>meer JSON-voorbeelden</p></li>
</ul>
</div>
<p>Je kunt een JSON-document eenvoudig omzetten in een JavaScript-object, en omgekeerd:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">obj</span> <span class="pre">=</span> <span class="pre">JSON.parse(str);</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">str</span> <span class="pre">=</span> <span class="pre">JSON.stringify(obj);</span></code></p></li>
</ul>
<p>Niet alle JavaScript-objecten kun je in JSON omzetten:</p>
<ul class="simple">
<li><p>objecten met functie-waarden</p></li>
<li><p>objecten met onderlinge verwijzingen die een lus (cykel) vormen.</p></li>
</ul>
<p>Veel programmeertalen hebben functies om JSON-objecten te verwerken.</p>
<ul class="simple">
<li><p>Python: <a class="reference external" href="https://docs.python.org/3/library/json.html">https://docs.python.org/3/library/json.html</a></p></li>
<li><p>Arduino: <a class="reference external" href="https://arduinojson.org/">https://arduinojson.org/</a></p></li>
</ul>
<div class="admonition-json-in-het-web admonition">
<p class="admonition-title">JSON in het web</p>
<p>Ook het web gebruikt het JSON-formaat, als onderdeel van AJAX.
JavaScript-functies in een app communiceren vanuit de browser met de server,
met (naar verhouding) kleine hoeveelheden data.
Deze communicatie gebruikt het compacte en leesbare JSON-formaat, in plaats van complete HTML-documenten.</p>
</div>
<p class="rubric">Links</p>
<ul class="simple">
<li><p>referentie: <a class="reference external" href="https://www.json.org/">https://www.json.org/</a></p></li>
<li><p>referentie: <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON</a></p></li>
<li><p>tutorial: <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/JSON">https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/JSON</a></p></li>
</ul>
<div class="section" id="json-lpp">
<h2>JSON-LPP<a class="headerlink" href="#json-lpp" title="Permalink naar deze titel">¶</a></h2>
<p>Voor onze toepassingen gebruiken we het JSON-formaat op een speciale manier:
het is de JSON-versie van het binaire Cayenne Low Power Payload-formaat.
Dit binaire formaat gebruiken we in andere ketens (RFM69, LoRa),
waar we erg zuinig moeten zijn met de bytes voor de payload.
Door voor de verschillende ketens hetzelfde JSON-LPP-formaat te gebruiken,
kunnen we dezelfde toepassing(en) gebruiken voor de verschillende ketens.</p>
<p class="rubric">Uplink-formaat</p>
<p>Voor de <em>uplink</em> berichten van de IoT-knopen gebruiken we de volgende elementen:</p>
<ul class="simple">
<li><dl class="simple">
<dt>metadata:</dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">nodeid</span></code>: de identificatie van een node (een string, bijvoorbeeld <code class="docutils literal notranslate"><span class="pre">&quot;fe3d&quot;</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">counter</span></code>: het volgnummer van een bericht (pakket)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rssi</span></code>: (optioneel) de signaalsterkte</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">time</span></code>: (optioneel) het tijdstip van de communicatie (ontvangst)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>payload:</dt><dd><ul>
<li><p>per sensor of actuator een <em>channel</em>, weergegeven voor een getal.</p></li>
<li><p>per channel: een object met (naam, waarde)-paren,</p></li>
<li><p>waarbij we vaste namen gebruiken, met een vaste betekenis van de waarden.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Voorbeeld json-lpp uplink bericht</span><a class="headerlink" href="#id2" title="Permalink naar deze broncode">¶</a></div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;nodeid&quot;</span><span class="p">:</span> <span class="s2">&quot;fe3d&quot;</span><span class="p">,</span>
 <span class="nt">&quot;counter&quot;</span><span class="p">:</span> <span class="mi">3027</span><span class="p">,</span>
 <span class="nt">&quot;payload&quot;</span><span class="p">:</span> <span class="p">{</span>
   <span class="nt">&quot;0&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;temperature&quot;</span><span class="p">:</span> <span class="mi">235</span><span class="p">},</span>
   <span class="nt">&quot;1&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;barometer&quot;</span><span class="p">:</span> <span class="mi">10093</span><span class="p">},</span>
   <span class="nt">&quot;2&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;dOut&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
   <span class="nt">&quot;8&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;aOut&quot;</span><span class="p">:</span> <span class="mi">255</span><span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>De onderstaande tabel geeft de namen voor de sensor-waarden en de betekenis van de bijbehorende waarden.</p>
<table class="colwidths-given docutils align-default" id="id3">
<caption><span class="caption-text">JSON-LPP types</span><a class="headerlink" href="#id3" title="Permalink naar deze tabel">¶</a></caption>
<colgroup>
<col style="width: 33%" />
<col style="width: 22%" />
<col style="width: 11%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Sensor</p></th>
<th class="head"><p>Naam</p></th>
<th class="head"><p>Bytes</p></th>
<th class="head"><p>Resolutie</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Digitale input</p></td>
<td><p>dIn</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>Digitale output</p></td>
<td><p>dOut</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>Analoge input</p></td>
<td><p>aIn</p></td>
<td><p>2</p></td>
<td><p>0.01 signed</p></td>
</tr>
<tr class="row-odd"><td><p>Analoge output</p></td>
<td><p>aOut</p></td>
<td><p>2</p></td>
<td><p>0.01 signed</p></td>
</tr>
<tr class="row-even"><td><p>Lichtniveau</p></td>
<td><p>illuminance</p></td>
<td><p>2</p></td>
<td><p>1 Lux unsigned</p></td>
</tr>
<tr class="row-odd"><td><p>Aanwezigheid</p></td>
<td><p>presence</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>Temperatuur</p></td>
<td><p>temperature</p></td>
<td><p>2</p></td>
<td><p>0.1 °C signed</p></td>
</tr>
<tr class="row-odd"><td><p>Rel. Luchtvochtigheid</p></td>
<td><p>humidity</p></td>
<td><p>1</p></td>
<td><p>0.5% unsigned</p></td>
</tr>
<tr class="row-even"><td><p>Luchtdruk</p></td>
<td><p>barometer</p></td>
<td><p>2</p></td>
<td><p>0.1 hPa unsigned</p></td>
</tr>
</tbody>
</table>
<p>Opmerkingen:</p>
<ul class="simple">
<li><p>het aantal bytes geeft het maximale bereik van de waarden aan,
bijvoorbeeld: 1 byte unsigned: 0..255, 2 bytes unsigned: 0..65536, 2 bytes signed: -32768..32767.
De gebruikelijke waarden vallen hier ruimschoots binnen.</p></li>
<li><p>we gebruiken als waarden alleen <em>gehele getallen</em>.
In een gebruikersinterface rekenen we deze om naar de gebruikelijke eenheden.
Bijvoorbeeld: <code class="docutils literal notranslate"><span class="pre">&quot;temperature&quot;:</span> <span class="pre">235</span></code> geven we dan weer als “23.5 ‘C”, en
<code class="docutils literal notranslate"><span class="pre">&quot;barometer&quot;:</span> <span class="pre">10097</span></code> als “1009.7 hPa”.</p></li>
<li><p>een IoT-knoop geeft in het uplink-bericht ook de waarden van de <em>actuatoren</em> (<code class="docutils literal notranslate"><span class="pre">dOut</span></code> en <code class="docutils literal notranslate"><span class="pre">aOut</span></code>).
Sommige toepassingen gebruiken dit om automatisch een besturingswidget voor een actuator te maken.</p></li>
<li><p>je moet zelf bijhouden welke sensor overeenkomt met “channel 1, nodeid 3ef2”;
bijvoorbeeld: de temperatuursensor in de woonkomer.
De toepassing zou deze administratie bij kunnen houden.</p></li>
</ul>
<p class="rubric">Downlink-formaat</p>
<p>Het formaat van de downlink-berichten is eenvoudiger:</p>
<ul class="simple">
<li><p>er is geen metadata; de nodeid volgt uit het MQTT-topic;</p></li>
<li><p>de payload bevat alleen de gegevens van één of meer outputs (actuators).</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Voorbeeld json-lpp downlink bericht</span><a class="headerlink" href="#id4" title="Permalink naar deze broncode">¶</a></div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;2&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;dOut&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
 <span class="nt">&quot;8&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;aOut&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
<jinja2.runtime.BlockReference object at 0x10843dad0>
<script type="text/javascript">
  $(document).trigger("runestone:login-complete");
</script>

  </body>
</html>