
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="nl">
  <head>
    <meta charset="utf-8" />
    <title>Webserver-Opdrachten &#8212; iot-0  documentatie</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Zoeken" href="../search.html" />
    <link rel="next" title="NodeRed-opdrachten" href="nodered-opdrachten.html" />
    <link rel="prev" title="Protocollen" href="webserver-protocol.html" />

<script type="application/json" class="js-hypothesis-config">
{
"showHighlights": false
}
</script>
<script async src="https://hypothes.is/embed.js"></script>


  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">iot-0</a></h1>








<h3>Navigatie</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../voorwoord.html">Voorwoord</a></li>
<li class="toctree-l1"><a class="reference internal" href="../inleiding.html">Inleiding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bouwstenen.html">Bouwstenen</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../webserver.html">Webserver-knopen</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="webserver-keten.html">Webserver-keten</a></li>
<li class="toctree-l2"><a class="reference internal" href="webserver-protocol.html">Protocollen</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Webserver-Opdrachten</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#iot-knoop-als-access-point">(1) IoT-knoop als Access Point</a></li>
<li class="toctree-l3"><a class="reference internal" href="#led-besturing-1">(2) LED-besturing (1)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ontwikkelaarstools">(3) Ontwikkelaarstools</a></li>
<li class="toctree-l3"><a class="reference internal" href="#led-besturing-2">(4) LED-besturing (2)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adresseren-van-de-webserver">(5) Adresseren van de webserver</a></li>
<li class="toctree-l3"><a class="reference internal" href="#een-eigen-voorbeeld">(6) Een eigen voorbeeld</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="nodered-opdrachten.html">NodeRed-opdrachten</a></li>
<li class="toctree-l2"><a class="reference internal" href="toetsvragen.html">Toetsvragen</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../wifi.html">WiFi-MQTT-knopen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rfm69.html">RFM69-knopen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lora.html">LoRa-knopen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configureren.html">Configureren</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ten-geleide.html">Voor de docent</a></li>
</ul>
<p class="caption"><span class="caption-text">Andere modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://infvo.github.io/com-0/">Com-0</a></li>
<li class="toctree-l1"><a class="reference external" href="https://infvo.github.io/iot-1/">IoT-1</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../webserver.html">Webserver-knopen</a><ul>
      <li>Previous: <a href="webserver-protocol.html" title="vorig hoofdstuk">Protocollen</a></li>
      <li>Next: <a href="nodered-opdrachten.html" title="volgend hoofdstuk">NodeRed-opdrachten</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Snel zoeken</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Zoek" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="webserver-opdrachten">
<h1>Webserver-Opdrachten<a class="headerlink" href="#webserver-opdrachten" title="Permalink naar deze titel">¶</a></h1>
<p>In de opdrachten gebruiken we een IoT-knoop met daarop een webserver.
Via een computer (browser) in hetzelfde netwerk als deze IoT-knoop maak je contact met deze webserver:
daarmee vraag je sensorwaarden van de IoT-knoop op en bestuur je de actuatoren (LEDs) van de knoop.</p>
<div class="admonition-wat-heb-je-nodig admonition">
<p class="admonition-title">Wat heb je nodig</p>
<ul class="simple">
<li><p>IoT-knoop met LED en webserver-software (<code class="docutils literal notranslate"><span class="pre">wifi-node-x(d)</span></code>);</p></li>
<li><p>computer of smartphone met browser;</p></li>
</ul>
</div>
<div class="section" id="iot-knoop-als-access-point">
<h2>(1) IoT-knoop als Access Point<a class="headerlink" href="#iot-knoop-als-access-point" title="Permalink naar deze titel">¶</a></h2>
<p>In het eerste voorbeeld gebruik je een IoT-knoop in Access Point mode.
Het gaat bij deze opdracht om het uitlezen van de sensorwaarden van de IoT-knoop.
In deze opdracht verander je de configuratie niet!</p>
<ol class="arabic simple">
<li><p>Start de IoT-knooop op in Access Point mode;
zie <a class="reference internal" href="../configureren.html#configureren"><span class="std std-ref">Configureren</span></a> stap 1.</p></li>
<li><p>Maak met je computer of je smartphone contact met het WiFi-netwerk van deze IoT-knoop;
zie <a class="reference internal" href="../configureren.html#configureren"><span class="std std-ref">Configureren</span></a> stap 2.</p></li>
<li><p>Geef in de browser als URL het IP-adres van de IoT-knoop: <code class="docutils literal notranslate"><span class="pre">http://192.168.4.1</span></code>
Je krijgt nu de homepagina van de IoT-knoop te zien.</p></li>
<li><p>Bestudeer de sensorwaarden in deze homepagina.
Adem of blaas voorzichtig op de temperatuur/luchtvochtigheidssensor van de IoT-knoop.
Veranderen de sensorwaarden in deze homepagina?</p></li>
<li><p>Ververs de pagina in de browser.
Veranderen de sensorwaarden in de pagina?</p></li>
<li><p>Beredeneer het gedrag van de browser/IoT-knoop dat je bij (4) en (5) gezien hebt.</p></li>
<li><p>Ga na wat het IP-adres van je eigen computer is in het netwerk van de IoT-knoop.</p></li>
</ol>
<p><strong>Opmerkingen</strong>.</p>
<ul class="simple">
<li><p>Je kunt met meerdere (max. 4) computers contact maken met een ESP8266-access point.</p></li>
<li><p>breng niet teveel IoT-knopen tegelijk in access-point mode: dat kan het andere WiFi-verkeer verstoren.</p></li>
<li><p>via het WiFi-netwerk van de IoT-knoop heeft je computer geen verbinding met het internet. (Ga dit na.)</p></li>
<li><p>het herhaald versturen van een verzoek aan de (web)server om te zien of er iets veranderd is heet “polling”.</p></li>
</ul>
</div>
<div class="section" id="led-besturing-1">
<h2>(2) LED-besturing (1)<a class="headerlink" href="#led-besturing-1" title="Permalink naar deze titel">¶</a></h2>
<p>De IoT-knoop heeft een eenvoudige manier om de LED aan en uit te zetten:</p>
<ol class="arabic simple">
<li><p>Vul als URL in de browser in: <code class="docutils literal notranslate"><span class="pre">http://192.168.4.1/ledon</span></code>.
Controleer dat de LED aan gaat.</p></li>
<li><p>Vul als URL in de browser in: <code class="docutils literal notranslate"><span class="pre">http://192.168.4.1/ledoff</span></code>.
Controleer dat de LED uit gaat.</p></li>
<li><p>Leg uit waarom er twee verschillende URLs zijn,
in plaats van één enkele die de LED omschakelt van aan naar uit en omgekeerd.
(<em>Hint</em>: zijn de acties <em>idempotent</em>?)</p></li>
</ol>
<p>De functies in de ESP8266-software voor <code class="docutils literal notranslate"><span class="pre">ledon</span></code> en <code class="docutils literal notranslate"><span class="pre">ledoff</span></code> zijn:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">handleLedOn</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">led0</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
  <span class="n">sendHTMLdoc</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">handleLedOff</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">led0</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
  <span class="n">sendHTMLdoc</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>De functie <code class="docutils literal notranslate"><span class="pre">digitalWrite</span></code> stuurt de led aan.
De functie <code class="docutils literal notranslate"><span class="pre">sendHTMLdoc()</span></code> stuurt de het homepagina-document naar de browser.
Zoals je ziet kun je met een URL soms heel direct hardware (actuatoren) besturen.</p>
<p>Er is nog een manier om de LED aan- en uit te schakelen: dit komt in opdracht (x) aan de orde.</p>
</div>
<div class="section" id="ontwikkelaarstools">
<h2>(3) Ontwikkelaarstools<a class="headerlink" href="#ontwikkelaarstools" title="Permalink naar deze titel">¶</a></h2>
<div class="admonition-browser-ontwikkelaarstools admonition">
<p class="admonition-title">Browser-ontwikkelaarstools</p>
<p>Moderne browsers beschikken over <em>ontwikkelaarstools</em> voor ontwikkelaars van websites.
Met deze tools kun je de interactie tussen de browser, de webserver en de html/css/javascript-bestanden volgen.</p>
<p>De manier waarop je deze tools vindt verschilt per browser:</p>
<ul class="simple">
<li><p>Chrome (OS X): Weergave-&gt;Ontwikkelaar-&gt;Ontwikkelaarstools</p></li>
<li><p>Chrome (Windows 10): Meer hulpprogramma’s-&gt;hulpprogramma’s voor ontwikkelaars (of “F12”)</p></li>
<li><p>FireFox: Extra-&gt;Webontwikkelaar-&gt;Hulpmiddelen in-/uitschakelen</p></li>
<li><p>Safari: Ontwikkel-&gt;Toon webinfovenster (je moet in de voorkeuren instellen dat dit menu getoond wordt).</p></li>
</ul>
</div>
<p>Via de browser-ontwikkelaarstools bestudeer je de interactie tussen de browser en de IoT-knoop als webserver.
Gebruik de IoT-knoop als Access Point, met als IP-adres 192.168.4.1, zie opdracht (1).</p>
<ol class="arabic simple">
<li><p>Bestudeer het http-protocol tussen de browser en de IoT-knoop-webserver via de tab “Netwerk”.
Door op een element links te klikken krijg je de gegevens over de interactie voor dat element.</p>
<ol class="loweralpha simple">
<li><p>Ga na wat het IP-adres is van de webserver (headers/kopteksten).</p></li>
<li><p>Welke informatie krijgt de browser over de webserver? (headers)</p></li>
<li><p>Welke informatie krijgt de webserver over de browser? (headers)</p></li>
<li><p>Voer als URL in de browser in: <code class="docutils literal notranslate"><span class="pre">http://192.168.4.1/ledon</span></code>.
Wat is het http-request (URL en method - GET, POST, etc.) dat de browser verstuurt?</p></li>
<li><p>In de home-pagina kun je via <em>buttons</em> de led aanzetten.
Wat is het http-request (URL, method, en parameters) dat de browser daarbij verstuurt?
(In opdracht xxxx wordt dit verder uitgewerkt)</p></li>
</ol>
</li>
<li><p>Bestudeer de timing van het http-protocol, via de tab “Netwerk”</p>
<ol class="loweralpha simple">
<li><p>wat is de totale tijd tussen het versturen van het request met URL: <code class="docutils literal notranslate"><span class="pre">http://192.168.4.1/ledon</span></code>,
en het ontvangen response van de server?
Dit is de end-to-end <em>latency</em> van de interactie tussen browser en server.</p></li>
<li><p>uit welke onderdelen bestaat deze tijd?</p></li>
<li><p>verstuur het request een aantal keren kort achter elkaar. Verandert de timing?
Welk onderdeel verandert vooral? Kun je dit verklaren?</p></li>
</ol>
</li>
<li><p>Bestudeer de brontekst van de homepagina van de IoT-knoop website, via de tab “Netwerk” of “Documenten”.</p>
<ol class="loweralpha simple">
<li><p>Wat is de grootte van het html-document (in bytes)?</p></li>
<li><p>Welk element in het html-document bevat de URL voor het aan- en uitzetten van de LED?
Geef de beginregel hiervan.</p></li>
</ol>
</li>
</ol>
</div>
<div class="section" id="led-besturing-2">
<h2>(4) LED-besturing (2)<a class="headerlink" href="#led-besturing-2" title="Permalink naar deze titel">¶</a></h2>
<p>Naast de eenvoudige URLs <code class="docutils literal notranslate"><span class="pre">/ledon</span></code> en <code class="docutils literal notranslate"><span class="pre">/ledoff</span></code> is er nog een manier om de LED aan- en uit te schakelen:
via de <em>buttons</em> op de homepagina.
Het gebruik van deze buttons resulteert in het opsturen van een formulier naar de webserver.</p>
<ol class="arabic simple">
<li><p>Klik op de “on”-button. De LED op de IoT-knoop brandt nu (als het goed is).
Welke URL verschijnt nu in het URL-venster? (Het kan nodig zijn om dit te selecteren.)</p></li>
<li><p>Laad de pagina opnieuw. (De browser heeft hiervoor een “refresh” of “reload”-knop, meestal een cirkel-pijlje.)
Wat is de reactie van de browser? Waarom geeft de browser deze reactie?</p></li>
<li><p>Soms wordt een webpagina ge-cached, in de browser, of in de keten tussen de browser en de server.
Een http GET-request bereikt dan niet altijd de server.
Ga na wat dit betekent voor (a) de aanpak met de eenvoudige URLs <code class="docutils literal notranslate"><span class="pre">/ledon</span></code> en <code class="docutils literal notranslate"><span class="pre">ledoff</span></code>;
(b) het gebruik van een formulier met een POST-request, zoals hierboven?</p></li>
<li><p>Kun je het formulier versturen door met de hand een URL in de browser in te vullen?</p></li>
</ol>
<p>De beide buttons zijn onderdeel van een <em>webformulier</em>.
De browser stuurt dit formulier via een HTTP-POST-request naar de server,
met als parameter het naam-waarde-paar: <code class="docutils literal notranslate"><span class="pre">on=1</span></code> voor “aan”; en <code class="docutils literal notranslate"><span class="pre">on=0</span></code> voor “uit”.</p>
<p>De server verwerkt het verzoek als volgt:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">handleLed0</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">server</span><span class="p">.</span><span class="n">method</span><span class="p">()</span> <span class="o">==</span> <span class="n">HTTP_POST</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">uint8_t</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">server</span><span class="p">.</span><span class="n">args</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">server</span><span class="p">.</span><span class="n">argName</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="s">&quot;on&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">String</span> <span class="n">argvalue</span> <span class="o">=</span> <span class="n">server</span><span class="p">.</span><span class="n">arg</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">argvalue</span> <span class="o">==</span> <span class="s">&quot;0&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">digitalWrite</span><span class="p">(</span><span class="n">ledPin</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">argvalue</span> <span class="o">==</span> <span class="s">&quot;1&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">digitalWrite</span><span class="p">(</span><span class="n">ledPin</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">sendHTMLdoc</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">server</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="n">handleRoot</span><span class="p">);</span>
<span class="n">server</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">&quot;/leds/0&quot;</span><span class="p">,</span> <span class="n">handleLedOn</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="adresseren-van-de-webserver">
<h2>(5) Adresseren van de webserver<a class="headerlink" href="#adresseren-van-de-webserver" title="Permalink naar deze titel">¶</a></h2>
<p>Als je met een browser de webserver van de IoT-knoop wilt benaderen,
moeten ze in hetzelfde lokale netwerk verbonden zijn.
Bovendien moet je het IP-adres van de IoT-knoop kennen.
In het geval van de IoT-knoop als access point ligt dat vast.
Maar als de IoT-knoop deel uitmaakt van een netwerk van een ander access point moet je het IP-adres zien te achterhalen.</p>
<p>Dit kan op verschillende manieren.
Probeer één of meer van de onderstaande methodes uit.
Ga na of het IP-adres klopt door de homepagina van de IoT-knoop in de browser te laten zien.</p>
<ol class="loweralpha simple">
<li><p>Sommige IoT-knopen hebben een display: bij het opstarten meldt de knoop het IP-adres op het display;</p></li>
<li><p>Een IoT-knoop meldt via de USB-verbinding bij het opstarten het IP-adres (en het MAC-adres).
Om dit te bekijken heb je nodig:
(i) de USB-driver voor de IoT-knoop (CHG340);
(ii) een programma om een seriële verbinding met de IoT-knoop te maken,
bijvoorbeeld de Arduino IDE (Seriële Monitor).</p></li>
<li><p>Gebruik een programma dat een netwerk-scan doet;
zie bijvoorbeeld  <a class="reference external" href="https://geekflare.com/network-scanner/">https://geekflare.com/network-scanner/</a> of voor een lijst.
“Angry IP Scanner” en “Advanced IP Scanner” zijn goede mogelijkheden.
Er zijn ook mobiele apps voor het scannen van het lokale netwerk, bijvoorbeeld “Fing”.
Een netwerkscanner geeft je niet alleen het IP-adres, maar ook het volledige MAC-adres van de IoT-knoop.</p></li>
</ol>
<p>Deze laatste methode geeft je ook inzicht in alle apparaten die aan het netwerk verbonden zijn.
Dit is vooral aan te raden voor een thuisnetwerk: herken je alle devices in het netwerk?</p>
<p>Er is nog een andere methode, die gebruik maakt van een eenvoudige DNS-service voor lokale netwerken:
mDNS (multicast DNS).
Deze aanpak laten we hier buiten beschouwing, omdat deze niet door alle browsers ondersteund wordt.</p>
</div>
<div class="section" id="een-eigen-voorbeeld">
<h2>(6) Een eigen voorbeeld<a class="headerlink" href="#een-eigen-voorbeeld" title="Permalink naar deze titel">¶</a></h2>
<p>Zoek een apparaat in je omgeving dat via een webinterface bediend kan worden.
Enkele suggesties: router; netwerkprinter; IoT-gateway (zoals de Hue Bridge).</p>
<ol class="arabic simple">
<li><p>Maak een schermafdruk van een bedieningspagina van dit apparaat.</p></li>
<li><dl class="simple">
<dt>beschrijf de karakteristieken van dit apparaat:</dt><dd><ol class="loweralpha simple">
<li><p>is de webserver altijd online?</p></li>
<li><p>hoe kun je de webserver vinden?</p></li>
<li><p>hoe krijg je veranderingen in de toestand van het apparaat gemeld?</p></li>
<li><p>moet je daarvoor de pagina in de browser verversen?</p></li>
</ol>
</dd>
</dl>
</li>
</ol>
</div>
</div>


          </div>
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2019, SLO.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../_sources/webserver/opdrachten.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>